name: Manual Terraform Actions

on:
    workflow_dispatch:
     inputs:
      name:
       description: 'Select the action to perform'
       type: string
       default: 'test'


jobs:
  tf-manual:
    name: âš™ï¸ Terraform Manual Actions
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ•µğŸ¾ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ§‘ğŸ¾â€âœˆï¸ Authenticate to GCP
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GOOGLE_CREDENTIALS }}
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      - name: Terraform Manual Action
        run: |
          cd ./configs/terraform
          echo 'ğŸš§ Creating tfvars file... ğŸš§'
          echo '${{ secrets.TERRAFORM_TFVARS }}' > terraform.tfvars
          terraform init
          terraform workspace select dev || terraform workspace new dev
          terraform ${{ github.event.inputs.name }} -auto-approve
          echo "âœ… Terraform action '${{ github.event.inputs.name }}' completed"

      - name: ğŸ’ğŸ¾â€â™‚ï¸ Clean up
        run: rm -f ./configs/terraform/*.json